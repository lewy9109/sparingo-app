{{ define "content" }}
<div class="grid gap-6 lg:grid-cols-[220px,minmax(0,1fr)]">
  <aside class="min-w-0 lg:sticky lg:top-6">
    <details class="group w-full min-w-0 rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm">
      <summary class="flex cursor-pointer items-center justify-between gap-3 text-sm font-semibold text-slate-700">
        <span class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" aria-hidden="true">
            <path fill="currentColor" d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
          </svg>
          Menu
        </span>
        <span class="text-xs text-slate-400">Akcje</span>
      </summary>
      <div class="mt-4 grid gap-2">
        <a href="/friendlies/new" class="btn btn-outline btn-sm">Dodaj mecz towarzyski</a>
        {{ if .Leagues }}
          <a href="/leagues/{{ (index .Leagues 0).ID }}" class="btn btn-outline btn-sm">Moja liga</a>
        {{ end }}
        <a href="/leagues/new" class="btn btn-outline btn-sm">Stwórz ligę</a>
        <a href="/leagues/search" class="btn btn-outline btn-sm">Wyszukaj ligę</a>
      </div>
    </details>
  </aside>

  <div class="grid min-w-0 gap-6">
    <section class="w-full min-w-0 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <h1 class="text-2xl font-semibold">Twoje ligi</h1>
      <p class="mt-1 text-sm text-slate-500">Szybki podgląd rankingów i ostatnich wydarzeń.</p>
      <div class="mt-6 grid gap-4">
        {{ if .Leagues }}
          {{ range .Leagues }}
            <a href="/leagues/{{ .ID }}" class="block rounded-xl border border-slate-200/80 p-4 transition hover:border-slate-400">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-lg font-medium">{{ .Name }}</div>
                  <div class="text-sm text-slate-500">{{ .Location }}</div>
                </div>
                <span class="text-sm text-slate-400">Zobacz</span>
              </div>
              <p class="mt-2 text-sm text-slate-600">{{ .Description }}</p>
            </a>
          {{ end }}
        {{ else }}
          <div class="rounded-xl border border-dashed border-slate-300 p-6 text-center text-slate-500">
            Obecnie nie biorę udziału w żadnej lidze. Wyszukaj ligę i wyślij prośbę o dołączenie.
          </div>
          <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <h2 class="text-lg font-semibold">Wyszukaj ligi</h2>
            <p class="mt-1 text-sm text-slate-500">Znajdź ligę i poproś o dołączenie.</p>
            <form method="get" action="/leagues/search" class="mt-4 flex flex-wrap gap-2">
              <input
                type="text"
                name="q"
                value="{{ .LeagueSearch.Query }}"
                class="input input-bordered w-full sm:flex-1"
                placeholder="Nazwa, opis lub lokalizacja"
                hx-get="/leagues/search/results"
                hx-trigger="keyup changed delay:300ms"
                hx-target="#league-search-results"
                hx-swap="outerHTML"
              >
              <button class="btn btn-primary">Szukaj</button>
            </form>
            {{ template "league_search_results.html" .LeagueSearch }}
          </div>
        {{ end }}
      </div>
    </section>

    {{ if .JoinRequests }}
      <section class="w-full min-w-0 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-xl font-semibold">Prośby o dołączenie</h2>
          <span class="text-xs text-slate-400">Tylko dla adminów i super admina</span>
        </div>
        <div class="mt-4 grid gap-2">
          {{ range .JoinRequests }}
            <div class="flex flex-wrap items-center justify-between gap-2 rounded-xl border border-slate-200/80 bg-slate-50 px-4 py-3">
              <div class="flex flex-wrap items-center gap-2">
                <span class="badge badge-outline">{{ .User.FullName }}</span>
                <span class="text-xs text-slate-500">{{ .User.Email }}</span>
                <span class="text-xs text-slate-400">Liga: {{ .League.Name }}</span>
              </div>
              <div class="flex flex-wrap items-center gap-2">
                <form method="post" action="/leagues/{{ .League.ID }}/join-requests/{{ .Request.ID }}/approve">
                  <button class="btn btn-xs btn-primary">Akceptuj</button>
                </form>
                <form method="post" action="/leagues/{{ .League.ID }}/join-requests/{{ .Request.ID }}/reject">
                  <button class="btn btn-xs btn-outline btn-error">Odrzuć</button>
                </form>
              </div>
            </div>
          {{ end }}
        </div>
      </section>
    {{ end }}

    <section class="w-full min-w-0 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <h2 class="text-xl font-semibold">Dostępne ligi</h2>
        <span class="text-xs text-slate-400">Najnowsze na górze</span>
      </div>
      <div class="mt-4 overflow-x-auto">
        <table class="table w-full">
          <thead>
            <tr>
              <th>Nazwa</th>
              <th>Lokalizacja</th>
              <th>Status</th>
              <th>Start</th>
              <th>Koniec</th>
              <th>Gracze</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{ if .AvailableLeagues }}
              {{ range .AvailableLeagues }}
                <tr>
                  <td class="font-medium">{{ .Name }}</td>
                  <td>{{ .Location }}</td>
                  <td>
                    {{ if eq .Status "active" }}Aktywna{{ else if eq .Status "upcoming" }}Nadchodząca{{ else }}Zakończona{{ end }}
                  </td>
                  <td>{{ .StartDate.Format "02 Jan 2006" }}</td>
                  <td>
                    {{ if .EndDate }}{{ .EndDate.Format "02 Jan 2006" }}{{ else }}—{{ end }}
                  </td>
                  <td>{{ len .PlayerIDs }}</td>
                  <td class="text-right">
                    <a href="/leagues/{{ .ID }}" class="btn btn-xs btn-outline">Szczegóły</a>
                  </td>
                </tr>
              {{ end }}
            {{ else }}
              <tr>
                <td colspan="7" class="text-sm text-slate-500">Brak dostępnych lig.</td>
              </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      {{ if gt .AvailableTotalPages 1 }}
        <div class="mt-3 flex flex-wrap items-center justify-between gap-2">
          <div class="text-xs text-slate-500">Strona {{ .AvailablePage }} z {{ .AvailableTotalPages }}</div>
          <div class="flex flex-wrap gap-2">
            {{ if .AvailableHasPrev }}
              <a class="btn btn-xs btn-outline" href="/?available_page={{ .AvailablePrevPage }}">Poprzednia</a>
            {{ end }}
            {{ range .AvailablePages }}
              <a class="btn btn-xs {{ if eq . $.AvailablePage }}btn-primary{{ else }}btn-outline{{ end }}" href="/?available_page={{ . }}">{{ . }}</a>
            {{ end }}
            {{ if .AvailableHasNext }}
              <a class="btn btn-xs btn-outline" href="/?available_page={{ .AvailableNextPage }}">Następna</a>
            {{ end }}
          </div>
        </div>
      {{ end }}
    </section>

    <section class="w-full min-w-0 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <div class="flex flex-wrap items-center justify-between gap-3">
      <h2 class="text-xl font-semibold">Twoje mecze</h2>
        <span class="text-xs text-slate-400">Maks. 6 wyników na zakładkę</span>
      </div>
      <div class="mt-4 flex flex-wrap gap-2 border-b border-slate-200 pb-3">
        <button
          class="btn btn-sm btn-primary"
          hx-get="/dashboard/tab/recent"
          hx-target="#dashboard-tab-content"
          hx-swap="innerHTML"
          hx-on="click: setActiveDashboardTab(this)"
        >Ostatnio rozgrywane mecze</button>
        <button
          class="btn btn-sm btn-outline"
          hx-get="/dashboard/tab/friendly"
          hx-target="#dashboard-tab-content"
          hx-swap="innerHTML"
          hx-on="click: setActiveDashboardTab(this)"
        >Mecze towarzyskie</button>
        <button
          class="btn btn-sm btn-outline"
          hx-get="/dashboard/tab/pending"
          hx-target="#dashboard-tab-content"
          hx-swap="innerHTML"
          hx-on="click: setActiveDashboardTab(this)"
        >Potwierdź mecze</button>
      </div>
      <div id="dashboard-tab-content" class="mt-4">
        {{ template "dashboard_tab.html" .DashboardRecent }}
      </div>
    </section>
  </div>
</div>
<script>
  (function () {
    window.setActiveDashboardTab = function (btn) {
      if (!btn) return;
      var container = btn.parentElement;
      if (!container) return;
      var buttons = container.querySelectorAll("button");
      buttons.forEach(function (item) {
        item.classList.remove("btn-primary");
        item.classList.add("btn-outline");
      });
      btn.classList.add("btn-primary");
      btn.classList.remove("btn-outline");
    };
  })();
</script>
{{ end }}
