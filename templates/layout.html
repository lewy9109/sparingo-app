{{ define "layout" }}
<!doctype html>
<html lang="pl" data-theme="cupcake">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ .Title }} · Sqoush</title>
  <link rel="stylesheet" href="/static/css/output.css">
  <script src="/static/htmx.min.js" defer></script>
  <style>
    :root {
      --app-bg: url('/static/img/unsplash1.jpg');
    }

    body {
      background:
        linear-gradient(120deg, rgba(248, 250, 252, 0.9), rgba(255, 255, 255, 0.92), rgba(254, 243, 199, 0.9)),
        var(--app-bg) center / cover no-repeat fixed;
    }
  </style>
  <script>
    (function () {
      var images = [
        "/static/img/unsplash1.jpg",
        "/static/img/unsplash2.jpg"
      ];
      var pick = images[Math.floor(Math.random() * images.length)];
      document.documentElement.style.setProperty("--app-bg", "url('" + pick + "')");
    })();
  </script>
</head>
<body class="min-h-screen text-slate-900">
  <header class="border-b border-slate-200/70 bg-white/80 backdrop-blur">
    <div class="mx-auto flex max-w-6xl items-center gap-4 px-4 py-4">
      <a href="/" class="text-xl font-semibold tracking-tight">Sqoush App</a>
      <div class="flex-1"></div>
      {{ if .IsAuthenticated }}
        <a href="/leagues/new" class="btn btn-sm btn-primary">+ Nowa liga</a>
        <a href="/friendlies/new" class="btn btn-sm btn-secondary" aria-label="Dodaj mecz towarzyski">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" aria-hidden="true">
            <path fill="currentColor" d="M14.5 3a6.5 6.5 0 1 0 4.6 11.1l1.6 1.6-1.4 1.4a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l1.4-1.4a1 1 0 0 0 0-1.4l-1.6-1.6 1.6-1.6a1 1 0 0 0 0-1.4l-2.4-2.4A6.47 6.47 0 0 0 14.5 3Zm0 2a4.5 4.5 0 1 1 0 9a4.5 4.5 0 0 1 0-9ZM4.3 15.7l3.9-3.9a1 1 0 0 1 1.4 1.4l-3.9 3.9a1 1 0 0 1-1.4-1.4Z"/>
          </svg>
        </a>
        <a href="/reports/new" class="btn btn-sm btn-outline">Zgłoś</a>
        <div class="text-sm text-slate-500">
          Zalogowany: <span class="font-medium text-slate-900">{{ .CurrentUser.FullName }}</span>
          {{ if eq .CurrentUser.Role "super_admin" }}
            <span class="ml-2 rounded-full bg-emerald-100 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-emerald-700">Super Admin</span>
          {{ else if eq .CurrentUser.Role "admin" }}
            <span class="ml-2 rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-amber-700">Admin</span>
          {{ end }}
        </div>
        {{ if eq .CurrentUser.Role "super_admin" }}
          <a href="/reports" class="btn btn-sm btn-outline">Zgłoszenia</a>
        {{ end }}
        {{ if and .IsDev (eq .CurrentUser.Role "super_admin") }}
          <form method="post" action="/dev/switch-user" class="flex items-center gap-2">
            <label class="text-xs uppercase tracking-wide text-slate-400">Dev: user</label>
            <select name="user_id" class="select select-bordered select-xs">
              {{ range .Users }}
                <option value="{{ .ID }}" {{ if eq .ID $.CurrentUser.ID }}selected{{ end }}>{{ .FullName }}</option>
              {{ end }}
            </select>
            <button class="btn btn-xs btn-outline">Przełącz</button>
          </form>
        {{ end }}
        <form method="post" action="/logout">
          <button class="btn btn-sm btn-ghost">Wyloguj</button>
        </form>
      {{ else }}
        <a href="/login" class="btn btn-sm btn-primary">Zaloguj</a>
        <a href="/register" class="btn btn-sm btn-outline">Zarejestruj</a>
      {{ end }}
    </div>
  </header>
  <main class="mx-auto max-w-6xl px-4 py-8">
    {{ if .FlashSuccess }}
      <div id="flash-success" class="mb-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
        {{ .FlashSuccess }}
      </div>
      <script>
        (function () {
          var el = document.getElementById("flash-success");
          if (!el) return;
          setTimeout(function () {
            el.style.opacity = "0";
            el.style.transition = "opacity 300ms ease";
            setTimeout(function () {
              if (el && el.parentNode) {
                el.parentNode.removeChild(el);
              }
            }, 350);
          }, 3000);
        })();
      </script>
    {{ end }}
    {{ template "content" . }}
  </main>
</body>
</html>
{{ end }}
