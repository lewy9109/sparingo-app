{{ define "content" }}
<section class="max-w-3xl">
  <div class="mb-6">
    <h1 class="text-2xl font-semibold">Dodaj mecz towarzyski</h1>
    <p class="mt-1 text-sm text-slate-500">Wybierz przeciwnika i wpisz wynik spotkania.</p>
  </div>
  <form
    id="friendly-form"
    method="post"
    action="/friendlies"
    class="grid gap-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
  >
    <div class="grid gap-3 rounded-xl border border-slate-200/70 bg-slate-50 p-4 sm:grid-cols-2">
      <div>
        <div class="text-xs uppercase tracking-wide text-slate-400">Gracz A</div>
        <div class="mt-1 text-base font-semibold text-slate-900">{{ .CurrentUser.FullName }}</div>
        <div class="text-xs text-slate-500">Zalogowany</div>
      </div>
      <div>
        <div class="text-xs uppercase tracking-wide text-slate-400">Gracz B</div>
        <div id="friendly-opponent-name" class="mt-1 text-base font-semibold text-slate-900">Wybierz przeciwnika</div>
        <div id="friendly-opponent-hint" class="text-xs text-slate-500">Przez wyszukiwarkę poniżej</div>
      </div>
    </div>
    {{ if .Form.Error }}
      <div class="rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
        {{ .Form.Error }}
      </div>
    {{ end }}
    {{ template "friendly_search_panel.html" .Form }}
    <div id="friendly-selected">
      {{ template "friendly_selected.html" .Form }}
    </div>
    <div>
      <label class="label"><span class="label-text">Data rozegrania</span></label>
      <input type="datetime-local" name="played_at" class="input input-bordered w-full" value="{{ .Form.PlayedAt }}">
    </div>
    <input type="hidden" name="sets_count" id="sets-count" value="5">
    <div class="flex items-center justify-between">
      <label class="label"><span class="label-text">Sety</span></label>
      <button type="button" id="add-set-btn" class="btn btn-xs btn-outline">Dodaj set</button>
    </div>
    <div class="text-xs text-slate-500">Możesz wpisać mniej niż 5 setów. Wystarczy jeden komplet A/B.</div>
    <div id="sets-grid" class="grid grid-cols-2 gap-3 sm:grid-cols-5">
      <div data-set="1">
        <label class="label"><span class="label-text">Set 1</span></label>
        <div class="flex gap-2">
          <input type="number" name="set_1_a" min="0" class="input input-bordered w-16" placeholder="A">
          <input type="number" name="set_1_b" min="0" class="input input-bordered w-16" placeholder="B">
        </div>
      </div>
      <div data-set="2">
        <label class="label"><span class="label-text">Set 2</span></label>
        <div class="flex gap-2">
          <input type="number" name="set_2_a" min="0" class="input input-bordered w-16" placeholder="A">
          <input type="number" name="set_2_b" min="0" class="input input-bordered w-16" placeholder="B">
        </div>
      </div>
      <div data-set="3">
        <label class="label"><span class="label-text">Set 3</span></label>
        <div class="flex gap-2">
          <input type="number" name="set_3_a" min="0" class="input input-bordered w-16" placeholder="A">
          <input type="number" name="set_3_b" min="0" class="input input-bordered w-16" placeholder="B">
        </div>
      </div>
      <div data-set="4">
        <label class="label"><span class="label-text">Set 4</span></label>
        <div class="flex gap-2">
          <input type="number" name="set_4_a" min="0" class="input input-bordered w-16" placeholder="A">
          <input type="number" name="set_4_b" min="0" class="input input-bordered w-16" placeholder="B">
        </div>
      </div>
      <div data-set="5">
        <label class="label"><span class="label-text">Set 5</span></label>
        <div class="flex gap-2">
          <input type="number" name="set_5_a" min="0" class="input input-bordered w-16" placeholder="A">
          <input type="number" name="set_5_b" min="0" class="input input-bordered w-16" placeholder="B">
        </div>
      </div>
    </div>
    <div class="flex flex-wrap gap-3">
      <button id="friendly-submit-btn" class="btn btn-primary">Dodaj wynik</button>
      <a href="/" class="btn btn-ghost">Wróć</a>
    </div>
  </form>
</section>
<div id="friendly-confirm-modal" class="fixed inset-0 z-[1000] hidden bg-slate-900/50 p-4" aria-hidden="true">
  <div class="flex min-h-full items-center justify-center">
    <div class="w-full max-w-md rounded-2xl border border-slate-200 bg-white p-6 shadow-xl">
    <h2 class="text-lg font-semibold">Potwierdź dodanie meczu</h2>
    <p class="mt-2 text-sm text-slate-600">Czy na pewno chcesz dodać mecz towarzyski?</p>
    <div class="mt-6 flex justify-end gap-2">
      <button type="button" id="friendly-cancel-btn" class="btn btn-outline">Anuluj</button>
      <button type="button" id="friendly-confirm-btn" class="btn btn-primary">Potwierdź</button>
    </div>
    </div>
  </div>
</div>
<script>
  (function () {
    var addBtn = document.getElementById("add-set-btn");
    var grid = document.getElementById("sets-grid");
    var counter = document.getElementById("sets-count");
    if (!addBtn || !grid || !counter) return;

    addBtn.addEventListener("click", function () {
      var nextIndex = parseInt(counter.value || "0", 10) + 1;
      counter.value = String(nextIndex);

      var wrapper = document.createElement("div");
      wrapper.setAttribute("data-set", String(nextIndex));
      wrapper.innerHTML =
        '<label class="label"><span class="label-text">Set ' + nextIndex + '</span></label>' +
        '<div class="flex gap-2">' +
        '<input type="number" name="set_' + nextIndex + '_a" min="0" class="input input-bordered w-16" placeholder="A">' +
        '<input type="number" name="set_' + nextIndex + '_b" min="0" class="input input-bordered w-16" placeholder="B">' +
        '</div>';
      grid.appendChild(wrapper);
    });
  })();
  (function () {
    var form = document.getElementById("friendly-form");
    var modal = document.getElementById("friendly-confirm-modal");
    var confirmBtn = document.getElementById("friendly-confirm-btn");
    var cancelBtn = document.getElementById("friendly-cancel-btn");
    if (!form || !modal || !confirmBtn || !cancelBtn) return;

    form.addEventListener("submit", function (event) {
      if (form.dataset.confirmed === "1") return;
      event.preventDefault();
      modal.classList.remove("hidden");
      modal.classList.add("flex");
      modal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    });

    confirmBtn.addEventListener("click", function () {
      form.dataset.confirmed = "1";
      modal.classList.add("hidden");
      modal.classList.remove("flex");
      modal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
      form.submit();
    });

    cancelBtn.addEventListener("click", function () {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
      modal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    });
  })();
</script>
{{ end }}
